#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -eo pipefail

# Heroku-provided params
BUILD_DIR="$1"
CACHE_DIR="$2"
ENV_DIR="$3"

mkdir $BUILD_DIR $CACHE_DIR
build=$(cd $BUILD_DIR && pwd)
cache=$(cd $CACHE_DIR && pwd)

cd $cache
curl -sL https://github.com/commercialhaskell/stack/releases/download/v0.1.3.1/stack-0.1.3.1-x86_64-linux.gz | gunzip > stack
chmod a+x $cache/stack
export PATH=$cache/stack:$PATH
cd -

cd $build
stack setup
stack build

